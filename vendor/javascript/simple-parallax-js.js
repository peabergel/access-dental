import e,{useState as r,useRef as i,useCallback as s,useEffect as a}from"react";class d{constructor(){this.callbacks=new Set,this.animationFrameId=null}static getInstance(){return d.instance||(d.instance=new d),d.instance}register(e){this.callbacks.add(e),this.animationFrameId===null&&this.start()}unregister(e){this.callbacks.delete(e),this.callbacks.size===0&&this.animationFrameId!==null&&this.stop()}start(){const t=()=>{this.callbacks.forEach((e=>e())),this.animationFrameId=requestAnimationFrame(t)};this.animationFrameId=requestAnimationFrame(t)}stop(){this.animationFrameId!==null&&(cancelAnimationFrame(this.animationFrameId),this.animationFrameId=null)}}const o=d.getInstance(),A=e=>{const[o,l]=r(0),[c,m]=r(!1),h=i(null),p=s((()=>{h.current&&l(h.current.height)}),[]);return a((()=>{const u=()=>{m(!0),p()},e=h.current;return e&&(e.complete?u():e.addEventListener("load",u)),window.addEventListener("resize",p),()=>{e&&e.removeEventListener("load",u),window.removeEventListener("resize",p)}}),[e,p]),[h,o,c]},j=(e,r)=>e*r-e,q=(e,r)=>Math.ceil(e/100*r-r/2),B=(e,r)=>{const{top:i,height:s}=e,a=-s,o=r;if(i<a)return 0;if(i>o)return 100;const l=(i-a)/(o-a)*100;return Math.min(Math.max(l,0),100)},G=(e,r)=>{switch(r){case"up":return`0, ${e}px, 0`;case"right":return-e+"px, 0, 0";case"down":return`0, ${-e}px, 0`;case"left":return`${e}px, 0, 0`;case"up left":return`${e}px, ${e}px, 0`;case"up right":return`${-e}px, ${e}px, 0`;case"down left":return`${e}px, ${-e}px, 0`;case"left right":return`${-e}px, ${-e}px, 0`;default:return`0, ${e}px, 0`}},O=()=>{const[e,i]=r(null);return a((()=>{const n=()=>{i(window.innerHeight)};if(typeof window<"u")return i(window.innerHeight),window.addEventListener("resize",n),()=>{window.removeEventListener("resize",n)}}),[]),e},W=({isLoaded:e,imageHeight:i,scale:s,boundingClientRect:o,orientation:l,maxTransition:c})=>{const[m,h]=r(0),[p,f]=r(0),[w,g]=r(""),[v,x]=r(0),$=O();return a((()=>{if(!e)return;const r=j(i,s);h(r)}),[e,i,s]),a((()=>{if(!e||!$||!o)return;let r=B(o,$);c&&(r=Math.min(r,100-c)),x(r)}),[e,o,$]),a((()=>{const e=q(v,m);f(e)}),[v,m]),a((()=>{const e=G(p,l);g(e)}),[p,l]),w},Y=(e={})=>{const[s,o]=r(!1),l=i(null);return a((()=>{const r=new IntersectionObserver((e=>{const[r]=e;r&&(r.isIntersecting?o(!0):o(!1))}),{...e}),{current:i}=l;return i&&r.observe(i),()=>{i&&r.unobserve(i)}}),[e]),[l,s]};var l="/Users/geoffrey/Desktop/perso/simpleParallax.js/src/react/index.tsx";const _=({delay:i=.4,orientation:c="up",scale:m=1.4,overflow:h=!1,transition:p="cubic-bezier(0,0,0,1)",maxTransition:f=null,children:w})=>{var g;const v=c??"up",x=m??1.2,$=(g=w==null?void 0:w.props)==null?void 0:g.src,[b,I]=r(!1),[F,E]=r(0),[y,L]=r(null),[k,z]=r(""),[M,C]=r(""),[H,N,R]=A($),[T,D]=Y({root:null,rootMargin:"0px",threshold:Array.from(Array(101).keys(),(e=>e/100))}),P=W({isLoaded:R,imageHeight:N,scale:x,boundingClientRect:y,orientation:v,maxTransition:f}),S=s((()=>{var e;if(!(!D&&b)&&(window.scrollY!==F||!b)){const r=(e=H.current)==null?void 0:e.getBoundingClientRect();r&&L(r),b||I(!0),E(window.scrollY)}}),[F,D,H]);a((()=>{let e=`translate3d(${P})`;h||(e+=` scale(${x})`),z(e)}),[P,x]),a((()=>{!p||!i||C(`transform ${i}s ${p}`)}),[p,i]),a((()=>(o.register(S),()=>{o.unregister(S)})),[S]);const U=e.isValidElement(w)?e.cloneElement(w,{style:{...w.props.style??{},transform:k,willChange:"transform",transition:M},ref:H}):null;return e.createElement("div",{ref:T,style:{overflow:h?"visible":"hidden"},__self:void 0,__source:{fileName:l,lineNumber:92,columnNumber:5}},U)};export{_ as default};

